@model HRM_Client.Models.IncomeStatisticsResponse
@{
    ViewBag.Title = "Income";
    Layout = "_DashboardLayout";
    
    var today = Model?.Today;
    var monthly = Model?.Monthly;
}

<link rel="stylesheet" href="~/css/common-styles.css" />

<div class="content-header">
    <div>
        <h1 class="content-title">Income Statistics</h1>
        <p class="content-subtitle">View your income statistics for today and this month</p>
    </div>
</div>

<style>
    .income-container {
        margin-top: 24px;
    }

    .period-toggle {
        display: flex;
        gap: 4px;
        background-color: #f6f8fa;
        border: 1px solid #d0d7de;
        border-radius: 6px;
        padding: 2px;
        margin-bottom: 24px;
        width: fit-content;
    }

    .period-btn {
        padding: 6px 16px;
        font-size: 14px;
        border: none;
        background: none;
        color: #57606a;
        cursor: pointer;
        border-radius: 4px;
        transition: all 0.2s;
    }

    .period-btn.active {
        background-color: #ffffff;
        color: #24292f;
        font-weight: 500;
        box-shadow: 0 1px 2px rgba(27,31,36,0.12);
    }

    .period-content {
        display: none;
    }

    .period-content.active {
        display: block;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 24px;
    }

    .stat-card {
        background-color: #ffffff;
        border: 1px solid #d0d7de;
        border-radius: 6px;
        padding: 24px;
    }

    .stat-card-title {
        font-size: 14px;
        font-weight: 500;
        color: #57606a;
        margin-bottom: 12px;
    }

    .stat-card-value {
        font-size: 32px;
        font-weight: 300;
        color: #24292f;
        margin-bottom: 8px;
    }

    .stat-card-description {
        font-size: 13px;
        color: #57606a;
    }

    .stat-card-value.positive {
        color: #1a7f37;
    }

    .stat-card-value.negative {
        color: #cf222e;
    }

    .details-card {
        background-color: #ffffff;
        border: 1px solid #d0d7de;
        border-radius: 6px;
        padding: 24px;
    }

    .details-title {
        font-size: 18px;
        font-weight: 400;
        color: #24292f;
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 1px solid #d0d7de;
    }

    .details-list {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .detail-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .detail-label {
        font-size: 14px;
        color: #57606a;
    }

    .detail-value {
        font-size: 16px;
        font-weight: 500;
        color: #24292f;
    }

    .detail-value.positive {
        color: #1a7f37;
    }

    .detail-value.negative {
        color: #cf222e;
    }

    .status-badge {
        display: inline-flex;
        align-items: center;
        padding: 4px 12px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 500;
    }

    .status-badge.present {
        background-color: #dafbe1;
        color: #1a7f37;
    }

    .status-badge.late {
        background-color: #fff8c5;
        color: #bf8700;
    }

    .status-badge.leaveearly {
        background-color: #fff8c5;
        color: #bf8700;
    }

    .status-badge.absent {
        background-color: #fff5f5;
        color: #cf222e;
    }

    .attendance-breakdown {
        margin-top: 24px;
        padding-top: 24px;
        border-top: 1px solid #d0d7de;
    }

    .breakdown-title {
        font-size: 16px;
        font-weight: 500;
        color: #24292f;
        margin-bottom: 16px;
    }

    .breakdown-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .breakdown-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        background-color: #f6f8fa;
        border-radius: 6px;
    }

    .breakdown-label {
        font-size: 14px;
        color: #24292f;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .breakdown-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
    }

    .breakdown-dot.present { background-color: #1a7f37; }
    .breakdown-dot.late { background-color: #bf8700; }
    .breakdown-dot.leaveearly { background-color: #bf8700; }
    .breakdown-dot.absent { background-color: #cf222e; }

    .breakdown-value {
        font-size: 14px;
        font-weight: 500;
        color: #24292f;
    }

    .empty-state {
        padding: 48px 20px;
        text-align: center;
        color: #57606a;
        font-size: 14px;
    }
</style>

<div class="income-container">
    <div class="period-toggle">
        <button class="period-btn active" onclick="switchPeriod('today')">Today</button>
        <button class="period-btn" onclick="switchPeriod('monthly')">This Month</button>
    </div>

    @if (Model == null)
    {
        <div class="empty-state">
            <p>Unable to load income statistics. Please try again later.</p>
        </div>
    }
    else
    {
        <!-- Today Content -->
        @if (today != null)
        {
            <div id="today" class="period-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-title">Base Salary (Monthly)</div>
                        <div class="stat-card-value">@FormatCurrency(today.BaseSalary)</div>
                        <div class="stat-card-description">Your monthly base salary</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-title">Daily Salary</div>
                        <div class="stat-card-value">@FormatCurrency(today.DailySalary)</div>
                        <div class="stat-card-description">Daily salary calculation</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-title">Today's Final Salary</div>
                        <div class="stat-card-value @(today.DeductionAmount > 0 ? "negative" : "positive")">@FormatCurrency(today.FinalSalary)</div>
                        <div class="stat-card-description">After deductions</div>
                    </div>
                    @if (today.DeductionAmount > 0)
                    {
                        <div class="stat-card">
                            <div class="stat-card-title">Deduction Amount</div>
                            <div class="stat-card-value negative">-@FormatCurrency(today.DeductionAmount)</div>
                            <div class="stat-card-description">@today.DeductionReason</div>
                        </div>
                    }
                </div>

                <div class="details-card">
                    <h2 class="details-title">Today's Details</h2>
                    <div class="details-list">
                        <div class="detail-item">
                            <span class="detail-label">Attendance Status</span>
                            <span class="status-badge @today.AttendanceStatus.ToLower()">@today.AttendanceStatus</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Daily Salary</span>
                            <span class="detail-value">@FormatCurrency(today.DailySalary)</span>
                        </div>
                        @if (today.DeductionAmount > 0)
                        {
                            <div class="detail-item">
                                <span class="detail-label">Deduction</span>
                                <span class="detail-value negative">-@FormatCurrency(today.DeductionAmount)</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Reason</span>
                                <span class="detail-value">@today.DeductionReason</span>
                            </div>
                        }
                        <div class="detail-item" style="margin-top: 12px; padding-top: 16px; border-top: 1px solid #d0d7de;">
                            <span class="detail-label" style="font-weight: 600;">Final Salary Today</span>
                            <span class="detail-value @(today.DeductionAmount > 0 ? "negative" : "positive")" style="font-size: 20px;">@FormatCurrency(today.FinalSalary)</span>
                        </div>
                    </div>
                </div>
            </div>
        }

        <!-- Monthly Content -->
        @if (monthly != null)
        {
            <div id="monthly" class="period-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-title">Base Salary</div>
                        <div class="stat-card-value">@FormatCurrency(monthly.BaseSalary)</div>
                        <div class="stat-card-description">Monthly base salary</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-title">Total Working Days</div>
                        <div class="stat-card-value">@monthly.TotalWorkingDays</div>
                        <div class="stat-card-description">Days with attendance records</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-title">Final Salary</div>
                        <div class="stat-card-value @(monthly.TotalDeduction > 0 ? "negative" : "positive")">@FormatCurrency(monthly.FinalSalary)</div>
                        <div class="stat-card-description">After all deductions</div>
                    </div>
                    @if (monthly.TotalDeduction > 0)
                    {
                        <div class="stat-card">
                            <div class="stat-card-title">Total Deduction</div>
                            <div class="stat-card-value negative">-@FormatCurrency(monthly.TotalDeduction)</div>
                            <div class="stat-card-description">From attendance violations</div>
                        </div>
                    }
                </div>

                <div class="details-card">
                    <h2 class="details-title">Monthly Details - @GetMonthName(monthly.CurrentMonth) @monthly.CurrentYear</h2>
                    <div class="details-list">
                        <div class="detail-item">
                            <span class="detail-label">Base Salary</span>
                            <span class="detail-value">@FormatCurrency(monthly.BaseSalary)</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Total Working Days</span>
                            <span class="detail-value">@monthly.TotalWorkingDays days</span>
                        </div>
                        @if (monthly.TotalDeduction > 0)
                        {
                            <div class="detail-item">
                                <span class="detail-label">Total Deduction</span>
                                <span class="detail-value negative">-@FormatCurrency(monthly.TotalDeduction)</span>
                            </div>
                        }
                        <div class="detail-item" style="margin-top: 12px; padding-top: 16px; border-top: 1px solid #d0d7de;">
                            <span class="detail-label" style="font-weight: 600;">Final Salary</span>
                            <span class="detail-value @(monthly.TotalDeduction > 0 ? "negative" : "positive")" style="font-size: 20px;">@FormatCurrency(monthly.FinalSalary)</span>
                        </div>
                    </div>

                    <div class="attendance-breakdown">
                        <h3 class="breakdown-title">Attendance Breakdown</h3>
                        <div class="breakdown-list">
                            <div class="breakdown-item">
                                <span class="breakdown-label">
                                    <span class="breakdown-dot present"></span>
                                    Present Days
                                </span>
                                <span class="breakdown-value">@monthly.PresentDays days</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">
                                    <span class="breakdown-dot late"></span>
                                    Late Days
                                </span>
                                <span class="breakdown-value">@monthly.LateDays days</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">
                                    <span class="breakdown-dot leaveearly"></span>
                                    Leave Early Days
                                </span>
                                <span class="breakdown-value">@monthly.LeaveEarlyDays days</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">
                                    <span class="breakdown-dot absent"></span>
                                    Absent Days
                                </span>
                                <span class="breakdown-value">@monthly.AbsentDays days</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    }
</div>

<script>
    function switchPeriod(period) {
        // Hide all period contents
        document.querySelectorAll('.period-content').forEach(content => {
            content.classList.remove('active');
        });
        
        // Remove active class from all buttons
        document.querySelectorAll('.period-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        // Show selected period content
        document.getElementById(period).classList.add('active');
        
        // Add active class to clicked button
        event.target.classList.add('active');
    }
</script>

@functions {
    private string FormatCurrency(decimal amount)
    {
        return string.Format("{0:N0} VND", amount);
    }

    private string GetMonthName(int month)
    {
        return new DateTime(2000, month, 1).ToString("MMMM");
    }
}

